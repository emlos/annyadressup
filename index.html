<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dress‑Up Game</title>
    <!-- jQuery & jQuery UI -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>
    <style>
        :root {
            --sidebar-width: 240px;
            --thumb-width: 90px;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, sans-serif;
            background: #fafafa;
            display: flex;
            justify-content: center;
            padding: 1rem;
        }

        #game {
            display: flex;
            gap: 1rem;
            max-width: 1000px;
            width: 100%;
        }

        /* ───────── Sidebar (tabs + items) ───────── */
        #sidebar {
            width: var(--sidebar-width);
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 0.75rem;
            padding: .75rem;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        #tabs {
            display: flex;
            gap: .5rem;
            margin-bottom: .5rem;
        }

        #tabs button {
            flex: 1;
            padding: .25rem;
            border: 1px solid #ddd;
            background: #f5f5f5;
            border-radius: .5rem;
            cursor: pointer;
            height: 48px;
            transition: background .2s;
        }

        #tabs button.active,
        #tabs button:hover {
            background: #e0e0e0;
        }

        #tabs img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            pointer-events: none;
        }

        /* Masonry‑ish grid */
        #itemsContainer {
            flex: 1;
            overflow-y: auto;
            column-count: 2;
            column-gap: .5rem;
        }

        .item-thumb {
            width: var(--thumb-width);
            max-width: 100%;
            height: auto;
            margin-bottom: .5rem;
            cursor: grab;
            display: block;
        }

        .used {
            visibility: hidden !important;
        }

        /* ───────── Stage ───────── */
        #stage {
            position: relative;
            flex: 1;
            max-width: 600px;
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 0.75rem;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #base {
            width: 100%;
            height: auto;
            display: block;
            pointer-events: none;
        }

        .placed {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: auto;
            cursor: grab;
            pointer-events: auto;
        }

        #itemsContainer::-webkit-scrollbar {
            width: 0;
            height: 0;
        }
    </style>
</head>

<body>
    <div id="game">
        <aside id="sidebar">
            <div id="tabs"></div>
            <div id="itemsContainer"></div>
        </aside>

        <main id="stage">
            <img id="base" src="img/base.png" alt="Model base">
        </main>
    </div>

    <script>
        /* ===============================
           Catalog definition
        =============================== */
        const catalog = {
            bras: {
                title: "Bras",
                icon: "img/icons/bras.png",
                items: [
                    {
                        thumb: "img/icons/bras/bra_1_icon.png",
                        image: "img/bras/bra_1.png",
                        mask: "img/bras/bra_1_mask.png"
                    },
                    {
                        thumb: "img/icons/bras/bra_2_icon.png",
                        image: "img/bras/bra_2.png",
                        mask: "img/bras/bra_2_mask.png"
                    }
                ]
            },
            panties: {
                title: "Panties",
                icon: "img/icons/panties.png",
                items: [
                    {
                        thumb: "img/icons/panties/panties_1_icon.png",
                        image: "img/panties/panties_1.png",
                        mask: "img/panties/panties_1_mask.png"
                    },
                    {
                        thumb: "img/icons/panties/panties_2_icon.png",
                        image: "img/panties/panties_2.png",
                        mask: "img/panties/panties_2_mask.png"
                    }
                ]
            },
            tops: {
                title: "Tops",
                icon: "img/icons/tops.png",
                items: [
                    {
                        thumb: "img/icons/tops/top_1_icon.png",
                        image: "img/tops/top_1.png",
                        mask: "img/tops/top_1_mask.png"
                    },
                    {
                        thumb: "img/icons/tops/top_2_icon.png",
                        image: "img/tops/top_2.png",
                        mask: "img/tops/top_2_mask.png"
                    }
                ]
            },
            bottoms: {
                icon: "img/icons/tops.png",
                items: [
                    { image: "img/tops/top_1.png", mask: "img/tops/top_1_mask.png" },
                    { image: "img/tops/top_2.png", mask: "img/tops/top_2_mask.png" }
                ]
            },
            outfits: {
                icon: "img/icons/tops.png",
                items: [
                    { image: "img/tops/top_1.png", mask: "img/tops/top_1_mask.png" },
                    { image: "img/tops/top_2.png", mask: "img/tops/top_2_mask.png" }
                ]
            },
            accessories: {
                icon: "img/icons/tops.png",
                items: [
                    { image: "img/tops/top_1.png", mask: "img/tops/top_1_mask.png" },
                    { image: "img/tops/top_2.png", mask: "img/tops/top_2_mask.png" }
                ]
            }
        };

        /* ===============================
           Build UI
        =============================== */
        const $tabs = $("#tabs");
        const $itemsContainer = $("#itemsContainer");
        let activeCat = null;

        function buildTabs() {
            for (const key in catalog) {
                const btn = $("<button>").attr("data-cat", key);
                btn.append($("<img>").attr("src", catalog[key].icon).attr("alt", key));
                $tabs.append(btn);
            }
            // Activate first tab by default
            $tabs.find("button").first().addClass("active");
            activeCat = $tabs.find("button").first().data("cat");
        }

        function buildItems(catKey) {
            $itemsContainer.empty();
            catalog[catKey].items.forEach((item, idx) => {
                const id = `${catKey}-${idx}`;
                const img = $("<img class='item-thumb'>")
                    .attr("src", item.image)
                    .attr("data-id", id)
                    .attr("alt", `${catKey} ${idx}`);
                $itemsContainer.append(img);
                makeDraggable(img);
            });
        }

        /* ===============================
           Drag & Drop logic
        =============================== */
        const $stage = $("#stage");
        const stageRect = () => $stage[0].getBoundingClientRect();

        function makeDraggable($el) {
            $el.draggable({
                helper: "clone",
                appendTo: "body",
                cursor: "grabbing",
                start(_, ui) {
                    ui.helper.css({ "z-index": 9999 });
                },
                stop(event, ui) {
                    const dropX = ui.offset.left + ui.helper.width() / 2;
                    const dropY = ui.offset.top + ui.helper.height() / 2;
                    const rect = stageRect();

                    // Inside stage?
                    if (dropX > rect.left && dropX < rect.right && dropY > rect.top && dropY < rect.bottom) {
                        placeOnStage($(event.target));
                    }
                }
            });
        }

        function placeOnStage($originThumb) {
            const id = $originThumb.data("id");
            if ($stage.find(`[data-origin='${id}']`).length) return; // already placed

            const img = $("<img class='placed'>")
                .attr("src", $originThumb.attr("src"))
                .attr("data-origin", id);

            $stage.append(img);

            $originThumb.addClass("used");

            img.draggable({
                containment: "document",
                cursor: "grabbing",
                stop(_, ui) {
                    const dropX = ui.offset.left + ui.helper.width() / 2;
                    const dropY = ui.offset.top + ui.helper.height() / 2;
                    const rect = stageRect();

                    // If moved outside stage → remove & restore thumb
                    if (!(dropX > rect.left && dropX < rect.right && dropY > rect.top && dropY < rect.bottom)) {
                        $originThumb.removeClass("used");
                        img.remove();
                    }
                }
            });
        }

        /* ===============================
           Event bindings
        =============================== */
        $tabs.on("click", "button", function () {
            const $btn = $(this);
            if ($btn.hasClass("active")) return;
            $tabs.find("button").removeClass("active");
            $btn.addClass("active");
            activeCat = $btn.data("cat");
            buildItems(activeCat);
        });

        /* ===============================
           Init
        =============================== */
        $(function () {
            buildTabs();
            buildItems(activeCat);
        });
    </script>
</body>

</html>